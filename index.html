<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>WildTrack Visual Search</title>
<style>
body{font-family:system-ui,Arial;margin:20px;max-width:900px}
#grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:16px}
.card{border:1px solid #ddd;border-radius:10px;padding:8px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.card img{width:100%;border-radius:8px}
small{color:#555}
</style>
</head>
<body>
<h2>WildTrack â€” SeaTurtleID Search</h2>
<p>Upload an image to find visually similar individuals.</p>
<input type="file" id="file" accept="image/*"/>
<input type="number" id="k" min="1" max="20" value="5" style="width:72px;margin-left:8px"/> top-k
<button id="btn">Search</button>
<div id="status"></div>
<div id="grid"></div>
<script>
const btn = document.getElementById('btn');
btn.onclick = async () => {
  const file = document.getElementById('file').files[0];
  const k = document.getElementById('k').value;
  if(!file){ alert('Choose an image first'); return; }
  const fd = new FormData();
  fd.append('file', file);
  fd.append('top_k', k);
  document.getElementById('status').innerText = 'Searching...';
  const res = await fetch('/search', { method:'POST', body: fd });
  const js = await res.json();
  document.getElementById('status').innerText = '';
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  js.results.forEach(r => {
    const div = document.createElement('div');
    div.className = 'card';
    const img = document.createElement('img');
    img.src = r.thumbnail || '';
    const p = document.createElement('div');
    p.innerHTML = `<b>${r.label}</b><br/><small>${r.path}</small><br/><small>sim=${r.similarity.toFixed(3)}</small>`;
    div.appendChild(img);
    div.appendChild(p);
    grid.appendChild(div);
  });
};
</script>
</body>
</html>
